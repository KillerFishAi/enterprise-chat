# 把项目部署到服务器 — 新手步骤

## 一、准备一台服务器

- 需要一台 **Linux 服务器**（阿里云、腾讯云、华为云等买的云服务器，或自己的 VPS）。
- 系统推荐：**Ubuntu 22.04** 或 **CentOS 7/8**。
- 内存建议 **至少 2GB**，1GB 可能不够跑 Docker。

---

## 二、在服务器上安装 Docker 和 Docker Compose

用 **SSH** 登录到你的服务器（Windows 可用 PowerShell 或安装 OpenSSH），然后执行下面命令。

### 如果是 Ubuntu / Debian

```bash
# 更新软件源
sudo apt update

# 安装 Docker
sudo apt install -y docker.io

# 启动 Docker 并设置开机自启
sudo systemctl start docker
sudo systemctl enable docker

# 安装 Docker Compose 插件
sudo apt install -y docker-compose-plugin

# 验证（能看到版本号就说明安装成功）
docker --version
docker compose version
```

### 如果是 CentOS

```bash
sudo yum install -y docker
sudo systemctl start docker
sudo systemctl enable docker
sudo yum install -y docker-compose-plugin
docker --version
docker compose version
```

---

## 三、把项目传到服务器上

任选一种方式即可。

### 方式 A：用 Git（推荐，你电脑上装了 Git 的话）

1. 在你这台电脑上，先把项目放到 **Git 仓库**（GitHub / Gitee / 公司 Git 等），并推送上去。
2. 在服务器上执行（把地址换成你的仓库地址）：

```bash
cd ~
git clone https://你的仓库地址.git
cd 仓库名/Enterprise-chat-layout-main
```

如果仓库名就是项目根目录，可能只需要：

```bash
cd ~
git clone https://你的仓库地址.git
cd 项目文件夹名
```

### 方式 B：用压缩包上传（不用 Git）

1. 在你这台 **Windows 电脑**上：
   - 进入项目根目录：`C:\Users\Administrator\Desktop\Enterprise-chat-layout-main\Enterprise-chat-layout-main`
   - 把**整个文件夹**打成 zip（注意要包含：`package.json`、`Dockerfile`、`docker-compose.yml`、`.env`、`app`、`components`、`lib`、`prisma`、`server`、`public` 等，**不要**打包 `node_modules` 和 `.next`，没有的话就不用管）。

2. 用 **FTP/SFTP 工具**（如 FileZilla、WinSCP）或 **SCP** 把 zip 传到服务器，例如传到 `/home/你的用户名/`。

3. 在**服务器**上解压并进入项目目录：

```bash
cd ~
unzip 你上传的压缩包名.zip
cd 解压出来的文件夹名
```

确保在这个目录里能看到：`docker-compose.yml`、`Dockerfile`、`.env`。

---

## 四、确认 .env 在服务器上

- 如果用 **方式 A（Git）**：记得把 `.env` 也放到仓库里（仅限私密仓库），或者上传后在服务器上**重新创建**一份 `.env`（内容和你本机一样）。
- 如果用 **方式 B**：压缩包里要包含 `.env`；如果没包含，在服务器上新建一个 `.env`，把本机那份内容复制进去。

在服务器上检查：

```bash
ls -la .env
cat .env   # 看一眼有没有 JWT_SECRET、DATABASE_URL 等
```

---

## 五、在服务器上启动项目

在**项目根目录**（有 `docker-compose.yml` 的目录）执行：

```bash
# 拉取镜像并构建、启动所有服务（数据库、Redis、网站、WebSocket）
docker compose up -d

# 查看是否都在运行
docker compose ps
```

看到 4 个服务（db、redis、app、ws）都是 **Up** 就说明启动成功。

---

## 六、开放端口（否则外网访问不了）

在**云服务器控制台**里：

1. 找到 **安全组** / **防火墙** 设置。
2. **入站规则**里放行：
   - **3000**（网页）
   - **3001**（WebSocket，如果前端要连这个端口的话）

保存后，用浏览器访问：

```
http://你的服务器公网IP:3000
```

例如：`http://123.45.67.89:3000`

---

## 七、常用命令（以后维护用）

| 操作           | 命令 |
|----------------|------|
| 停止所有服务   | `docker compose down` |
| 重新启动       | `docker compose up -d` |
| 查看运行状态   | `docker compose ps` |
| 查看应用日志   | `docker compose logs -f app` |
| 查看 WebSocket 日志 | `docker compose logs -f ws` |

---

## 八、小结

1. 服务器装好 **Docker** 和 **Docker Compose**。
2. 把**项目整个目录**（含 `.env`、`docker-compose.yml`、`Dockerfile` 等）弄到服务器上（Git 或压缩包上传）。
3. 在项目根目录执行：`docker compose up -d`。
4. 安全组放行 **3000**（和按需 **3001**）端口。
5. 浏览器访问 `http://服务器IP:3000`。

如果你告诉我：用的是哪家云、有没有域名、会不会用 SSH，我可以按你的情况写成一版「复制粘贴就能用」的命令。
